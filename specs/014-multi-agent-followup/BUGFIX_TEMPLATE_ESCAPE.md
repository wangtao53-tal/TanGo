# Bugä¿®å¤ï¼šæ¨¡æ¿æ ¼å¼åŒ–é”™è¯¯

## ğŸ› é—®é¢˜æè¿°

åœ¨çœŸå®ç¯å¢ƒæµ‹è¯•ä¸­ï¼Œå‘ç°ä»¥ä¸‹é”™è¯¯ï¼š

```
{"@timestamp":"2025-12-24T17:08:42.057+08:00","caller":"nodes/intent_agent_node.go:209","content":"æ¨¡æ¿æ ¼å¼åŒ–å¤±è´¥","error":"could not find key: \n  \"intent\"","level":"error"}
{"@timestamp":"2025-12-24T17:08:42.057+08:00","caller":"nodes/learning_planner_node.go:197","content":"æ¨¡æ¿æ ¼å¼åŒ–å¤±è´¥","error":"could not find key: \n  \"continue\"","level":"error"}
```

## ğŸ” é—®é¢˜åŸå› 

einoæ¨¡æ¿å¼•æ“åœ¨è§£æ`SystemMessage`æ—¶ï¼Œä¼šå°†æ‰€æœ‰`{...}`æ ¼å¼çš„å†…å®¹è¯†åˆ«ä¸ºæ¨¡æ¿å˜é‡ã€‚å½“SystemMessageä¸­åŒ…å«JSONç¤ºä¾‹æ—¶ï¼ŒJSONä¸­çš„å­—æ®µåï¼ˆå¦‚`"intent"`ã€`"continue"`ï¼‰ä¼šè¢«è¯¯è®¤ä¸ºæ˜¯æ¨¡æ¿å˜é‡ï¼Œå¯¼è‡´æ ¼å¼åŒ–å¤±è´¥ã€‚

### é—®é¢˜ä»£ç ç¤ºä¾‹

```go
schema.SystemMessage(`è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{
  "intent": "è®¤çŸ¥å‹|æ¢å› å‹|è¡¨è¾¾å‹|æ¸¸æˆå‹|æƒ…ç»ªå‹",
  "confidence": 0.0-1.0ä¹‹é—´çš„æµ®ç‚¹æ•°,
  "reason": "è¯†åˆ«åŸå› ï¼ˆå¯é€‰ï¼‰"
}`)
```

einoæ¨¡æ¿å¼•æ“ä¼šå°è¯•æŸ¥æ‰¾åä¸º`intent`çš„æ¨¡æ¿å˜é‡ï¼Œä½†å®é™…æ¨¡æ¿å˜é‡æ˜¯`message`å’Œ`chat_history`ï¼Œå› æ­¤æŠ¥é”™ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨åŒèŠ±æ‹¬å·`{{`å’Œ`}}`æ¥è½¬ä¹‰JSONç¤ºä¾‹ä¸­çš„èŠ±æ‹¬å·ï¼Œé¿å…è¢«einoæ¨¡æ¿å¼•æ“è§£æä¸ºæ¨¡æ¿å˜é‡ã€‚

### ä¿®å¤åçš„ä»£ç 

```go
schema.SystemMessage(`è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{{
  "intent": "è®¤çŸ¥å‹|æ¢å› å‹|è¡¨è¾¾å‹|æ¸¸æˆå‹|æƒ…ç»ªå‹",
  "confidence": 0.0-1.0ä¹‹é—´çš„æµ®ç‚¹æ•°,
  "reason": "è¯†åˆ«åŸå› ï¼ˆå¯é€‰ï¼‰"
}}`)
```

## ğŸ“ ä¿®å¤çš„æ–‡ä»¶

1. âœ… `backend/internal/agent/nodes/intent_agent_node.go`
   - è½¬ä¹‰JSONç¤ºä¾‹ä¸­çš„èŠ±æ‹¬å·

2. âœ… `backend/internal/agent/nodes/learning_planner_node.go`
   - è½¬ä¹‰JSONç¤ºä¾‹ä¸­çš„èŠ±æ‹¬å·

3. âœ… `backend/internal/agent/nodes/reflection_agent_node.go`
   - è½¬ä¹‰JSONç¤ºä¾‹ä¸­çš„èŠ±æ‹¬å·ï¼ˆé¢„é˜²æ€§ä¿®å¤ï¼‰

4. âœ… `backend/internal/agent/nodes/cognitive_load_node.go`
   - è½¬ä¹‰JSONç¤ºä¾‹ä¸­çš„èŠ±æ‹¬å·ï¼ˆé¢„é˜²æ€§ä¿®å¤ï¼‰

## ğŸ§ª éªŒè¯

è¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤ï¼š

```bash
cd backend
go test -v ./internal/agent/nodes -run TestIntentAgentNode_RecognizeIntent
```

æµ‹è¯•é€šè¿‡ âœ…

## ğŸ“š ç›¸å…³æ–‡æ¡£

- einoæ¨¡æ¿å¼•æ“æ–‡æ¡£ï¼šhttps://www.cloudwego.io/zh/docs/eino/
- æ¨¡æ¿å˜é‡è½¬ä¹‰è§„åˆ™ï¼šä½¿ç”¨`{{`å’Œ`}}`è½¬ä¹‰èŠ±æ‹¬å·

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ‰€æœ‰JSONç¤ºä¾‹éƒ½éœ€è¦è½¬ä¹‰**ï¼šåœ¨SystemMessageä¸­åŒ…å«JSONç¤ºä¾‹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨`{{`å’Œ`}}`è½¬ä¹‰
2. **ä»…è½¬ä¹‰JSONç¤ºä¾‹**ï¼šä¸è¦è½¬ä¹‰å®é™…çš„æ¨¡æ¿å˜é‡ï¼ˆå¦‚`{message}`ã€`{userAge}`ç­‰ï¼‰
3. **é¢„é˜²æ€§ä¿®å¤**ï¼šå³ä½¿å½“å‰æ²¡æœ‰æŠ¥é”™ï¼Œä¹Ÿå»ºè®®è½¬ä¹‰æ‰€æœ‰JSONç¤ºä¾‹ï¼Œé¿å…æœªæ¥å‡ºç°é—®é¢˜

## ğŸ”„ ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰
```go
schema.SystemMessage(`è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{
  "intent": "...",
  "confidence": 0.0-1.0
}`)
```

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰
```go
schema.SystemMessage(`è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{{
  "intent": "...",
  "confidence": 0.0-1.0
}}`)
```

## âœ… ä¿®å¤çŠ¶æ€

- [x] Intent AgentèŠ‚ç‚¹ - å·²ä¿®å¤
- [x] Learning Planner AgentèŠ‚ç‚¹ - å·²ä¿®å¤
- [x] Reflection AgentèŠ‚ç‚¹ - å·²ä¿®å¤ï¼ˆé¢„é˜²æ€§ï¼‰
- [x] Cognitive Load AgentèŠ‚ç‚¹ - å·²ä¿®å¤ï¼ˆé¢„é˜²æ€§ï¼‰
- [x] æµ‹è¯•éªŒè¯ - é€šè¿‡

ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥åœ¨çœŸå®ç¯å¢ƒä¸­æ­£å¸¸ä½¿ç”¨å¤šAgentåŠŸèƒ½äº†ã€‚

