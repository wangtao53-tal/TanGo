# 功能规范：优化识别流程与对话体验

**功能分支**: `004-optimize-identify-flow`  
**创建日期**: 2025-12-18  
**状态**: 草稿  
**输入**: 用户描述：1. 拍照识别后，直接跳转到问答页，展示识别到的内容，再去生成卡片 2. 知识卡片中可以先不携带图片 3. 追问时需要在页面展示问题，再流式输出内容，给用户及时响应

## 用户场景与测试 *(必填)*

### 用户故事 1 - 识别后直接跳转问答页（优先级: P1）

用户拍照识别后，系统直接跳转到问答页面，首先展示识别到的内容（对象名称、类别等），然后通过对话触发生成知识卡片，而不是在识别后立即生成卡片。

**为什么是最高优先级**：这是用户体验流程的核心优化，符合项目规范（原则七），确保用户能够立即看到识别结果并开始对话，提供更流畅的交互体验。没有这个功能，用户无法获得及时的反馈和连贯的体验。

**独立测试**：可以完全独立测试，拍照识别后验证系统是否直接跳转到问答页面，是否首先展示识别结果，是否支持通过对话触发卡片生成。

**接受场景**：

1. **Given** 用户拍照并完成图像识别，**When** 系统识别出对象，**Then** 系统直接跳转到问答页面（对话页面），而不是结果页面
2. **Given** 用户进入问答页面，**When** 页面加载完成，**Then** 页面首先展示识别到的内容（对象名称、类别、置信度等），作为对话的初始上下文
3. **Given** 用户在问答页面看到识别结果，**When** 用户发送消息（如"帮我生成卡片"），**Then** 系统通过对话触发知识卡片生成，而不是在识别后立即生成
4. **Given** 识别结果已展示在问答页面，**When** 用户继续对话，**Then** 识别结果作为对话的初始上下文，支持用户进一步探索

---

### 用户故事 2 - 知识卡片简化显示（优先级: P2）

知识卡片在对话中展示时，暂时不显示图片，只显示文本内容，简化界面并聚焦内容。

**为什么是第二优先级**：这是界面优化，简化卡片展示，减少加载时间，提升用户体验。虽然不是核心功能，但对用户体验有积极影响。

**独立测试**：可以独立测试，在对话中生成知识卡片后，验证卡片是否只显示文本内容，不显示图片。

**接受场景**：

1. **Given** 系统在对话中生成知识卡片，**When** 卡片显示在对话消息列表中，**Then** 卡片只显示文本内容（标题、正文等），不显示图片
2. **Given** 用户查看知识卡片，**When** 卡片内容加载完成，**Then** 卡片布局清晰，文本内容完整，没有图片占位符或加载状态
3. **Given** 不同类型的知识卡片（科学认知卡、古诗词/人文卡、英语表达卡），**When** 在对话中展示，**Then** 所有卡片都遵循不显示图片的规则

---

### 用户故事 3 - 追问时即时展示用户问题（优先级: P1）

用户在对话中发送问题（文本、语音、图片）时，系统立即在对话界面中展示用户发送的问题，然后通过流式返回展示系统响应，给用户及时反馈。

**为什么是最高优先级**：这是对话体验的基础，用户必须能够看到自己发送的问题，才能确认系统是否正确理解，这是对话系统的基本要求。没有这个功能，用户无法获得完整的对话体验。

**独立测试**：可以完全独立测试，在对话中发送问题（文本、语音、图片），验证问题是否立即显示在对话列表中，系统响应是否通过流式返回实时展示。

**接受场景**：

1. **Given** 用户在问答页面，**When** 用户发送文本问题，**Then** 问题立即显示在对话列表中，显示为用户消息，包含时间戳和发送者标识
2. **Given** 用户在问答页面，**When** 用户发送语音问题，**Then** 语音识别结果立即显示在对话列表中，显示为用户消息
3. **Given** 用户在问答页面，**When** 用户上传图片问题，**Then** 图片立即显示在对话列表中，显示为用户消息
4. **Given** 用户问题已显示在对话列表中，**When** 系统处理问题并生成响应，**Then** 系统响应通过流式返回实时展示，提供加载状态和进度反馈
5. **Given** 用户发送问题后，**When** 系统响应过程中，**Then** 用户可以看到问题的完整内容，确认系统正在处理正确的问题

---

### 边界情况

- 当识别失败或识别结果为空时，系统如何处理跳转和展示？
- 当网络连接不稳定时，流式返回如何提供友好的错误提示和重试机制？
- 当用户快速连续发送多个问题时，系统如何正确展示每个问题和对应的响应？
- 当流式返回中断时，系统如何保存已返回的内容并提示用户？
- 当识别结果包含敏感信息时，系统如何在问答页面中安全展示？

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须在拍照识别完成后，直接跳转到问答页面（对话页面），而不是结果页面
- **FR-002**: 系统必须在问答页面首先展示识别到的内容（对象名称、类别、置信度等），作为对话的初始上下文
- **FR-003**: 系统必须支持通过对话触发知识卡片生成，而不是在识别后立即生成卡片
- **FR-004**: 系统必须在对话中展示知识卡片时，只显示文本内容，不显示图片
- **FR-005**: 系统必须在用户发送问题（文本、语音、图片）后，立即在对话界面中展示用户发送的问题
- **FR-006**: 系统必须为所有用户消息包含时间戳和发送者标识
- **FR-007**: 系统必须通过流式返回实时展示系统响应，提供加载状态和进度反馈
- **FR-008**: 系统必须正确维护对话状态，确保识别结果和对话上下文正确关联
- **FR-009**: 系统必须在页面跳转时，正确传递和恢复状态（识别结果、对话上下文等）
- **FR-010**: 系统必须在错误情况下提供清晰的错误提示和恢复建议

### 关键实体 *(如功能涉及数据)*

- **识别结果（Identification Result）**：包含对象名称、类别、置信度等，作为对话的初始上下文
- **对话消息（Conversation Message）**：包含用户消息和系统响应，必须包含时间戳和发送者标识
- **知识卡片（Knowledge Card）**：在对话中展示时只包含文本内容，不包含图片
- **对话状态（Conversation State）**：维护识别结果和对话上下文的关联，支持多轮对话

## 成功标准 *(必填)*

### 可衡量的结果

- **SC-001**: 用户拍照识别后，系统在2秒内完成跳转到问答页面并展示识别结果
- **SC-002**: 用户在问答页面发送问题后，问题在0.5秒内显示在对话列表中
- **SC-003**: 系统响应通过流式返回，用户能在1秒内看到响应的开始内容
- **SC-004**: 95%的用户能够成功完成从拍照识别到对话交互的完整流程
- **SC-005**: 知识卡片在对话中展示时，加载时间不超过1秒（不包含图片加载）
- **SC-006**: 用户消息和系统响应的展示准确率达到100%（所有消息都正确显示）
