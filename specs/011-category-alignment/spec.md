# Feature Specification: 知识卡片分类功能对齐与优化

**Feature Branch**: `dev-mvp-20251218`  
**Created**: 2025-12-20  
**Status**: Draft  
**Input**: User description: "前端-关于三个知识卡片的分类， 自然类、生活类、人文类。需要对齐所有地方功能的实现。比如拍照后首次识别的分类，确定这个卡片属于什么，收藏后，对应收藏页面，也需要支持筛选，和全部。学情报告-知识地图里面有对应识别的数量，每拍照探索一次，就次数上涨。移除知识地图的tip按钮，没有作用。知识地图和探索数量总数对应一致。移除收藏页面的，家长模式和导出全部 按钮功能。收藏页面的收藏按钮点击支持取消收藏，点击卡片支持收藏。"

**Note**: MVP版本阶段，所有开发工作统一在 `dev-mvp-20251218` 分支进行，不采用一个功能一个分支的策略。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 知识卡片分类一致性对齐 (Priority: P1)

用户在拍照识别后，系统能够正确识别并分类对象（自然类、生活类、人文类），该分类信息在所有相关页面（识别结果页、收藏页面、学习报告）中保持一致显示。

**Why this priority**: 这是核心功能的基础，确保用户在整个应用中获得一致的数据展示体验，避免混淆和错误理解。

**Independent Test**: 拍照识别一个对象（如"银杏"），验证识别结果页显示正确的分类标签，收藏后，在收藏页面和学习报告中都能看到相同的分类信息。

**Acceptance Scenarios**:

1. **Given** 用户拍照识别了一个自然类对象（如"银杏"），**When** 系统完成识别并返回结果，**Then** 识别结果页显示"自然类"分类标签，且该分类信息正确保存到探索记录中
2. **Given** 用户收藏了多个不同分类的知识卡片，**When** 用户在收藏页面选择"自然类"筛选，**Then** 只显示自然类的收藏记录，选择"全部"时显示所有收藏记录
3. **Given** 用户已完成多次探索，**When** 用户查看学习报告的知识地图，**Then** 知识地图中显示的三类数量与探索记录中的分类统计一致

---

### User Story 2 - 学习报告数据统计准确性 (Priority: P1)

学习报告页面能够准确统计和展示探索数据，知识地图的类别数量与总探索次数保持一致。

**Why this priority**: 数据准确性直接影响用户体验和信任度，错误的数据统计会导致用户困惑。

**Independent Test**: 完成3次探索（自然类2次、生活类1次），验证学习报告中总探索次数为3，知识地图中自然类显示2次、生活类显示1次，且知识地图总数与总探索次数一致。

**Acceptance Scenarios**:

1. **Given** 用户已完成多次探索，**When** 用户查看学习报告页面，**Then** 知识地图中显示的三类数量总和等于总探索次数
2. **Given** 用户完成一次新的探索，**When** 用户再次查看学习报告，**Then** 总探索次数和对应类别的数量都正确增加
3. **Given** 用户查看学习报告的知识地图，**When** 知识地图显示数据，**Then** 知识地图中没有tip按钮，界面简洁清晰

---

### User Story 3 - 收藏功能优化 (Priority: P2)

收藏页面移除不必要的功能按钮，优化收藏交互体验，支持取消收藏和点击卡片收藏。

**Why this priority**: 简化界面，提升用户体验，使收藏功能更加直观易用。

**Independent Test**: 在收藏页面验证家长模式和导出全部按钮已移除，点击收藏按钮可以取消收藏，点击卡片可以收藏。

**Acceptance Scenarios**:

1. **Given** 用户在收藏页面，**When** 查看页面头部操作区域，**Then** 不显示"家长模式"和"导出全部"按钮
2. **Given** 用户已收藏某个知识卡片，**When** 用户点击该卡片的收藏按钮，**Then** 卡片取消收藏，收藏按钮状态更新为未收藏
3. **Given** 用户未收藏某个知识卡片，**When** 用户点击该卡片（非按钮区域），**Then** 卡片被收藏，收藏状态更新

---

### Edge Cases

- 当探索记录中没有某个分类的数据时，知识地图如何显示该分类的数量？
- 当用户取消收藏最后一个卡片时，收藏页面如何显示空状态？
- 当用户快速连续点击收藏按钮时，系统如何处理并发操作？
- 当探索记录的分类字段为空或无效时，系统如何处理？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须在拍照识别时正确返回并保存对象的分类信息（自然类、生活类、人文类）
- **FR-002**: 系统必须在识别结果页面正确显示对象的分类标签
- **FR-003**: 系统必须在收藏页面支持按分类筛选功能（全部、自然类、生活类、人文类）
- **FR-004**: 系统必须在学习报告的知识地图中正确统计并显示三类别的探索数量
- **FR-005**: 系统必须确保知识地图中三类数量总和与总探索次数完全一致
- **FR-006**: 系统必须在用户完成每次探索后，正确更新学习报告中的统计数据
- **FR-007**: 系统必须从学习报告的知识地图区域移除tip按钮
- **FR-008**: 系统必须从收藏页面移除"家长模式"和"导出全部"按钮
- **FR-009**: 系统必须支持在收藏页面通过点击收藏按钮来取消收藏
- **FR-010**: 系统必须支持在收藏页面通过点击卡片来收藏该卡片
- **FR-011**: 系统必须确保所有页面（识别结果页、收藏页面、学习报告）中显示的分类信息保持一致

### Key Entities *(include if feature involves data)*

- **探索记录（ExplorationRecord）**：包含对象名称、分类（objectCategory）、识别时间等信息，分类字段必须正确保存
- **知识卡片（KnowledgeCard）**：关联到探索记录，继承探索记录的分类信息
- **学习报告统计（LearningReportStats）**：包含总探索次数、各类别探索次数，必须保持数据一致性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100%的探索记录都包含有效的分类信息（自然类、生活类、人文类之一）
- **SC-002**: 收藏页面的分类筛选功能正常工作，筛选结果准确率达到100%
- **SC-003**: 学习报告中知识地图的三类数量总和与总探索次数的差异为0（完全一致）
- **SC-004**: 用户完成探索后，学习报告统计数据在1秒内正确更新
- **SC-005**: 收藏和取消收藏操作的响应时间在500毫秒内完成
- **SC-006**: 所有相关页面显示的分类信息一致性达到100%（无数据不一致情况）

## Assumptions

- 探索记录中的objectCategory字段已正确保存，无需修改后端数据结构
- 前端本地存储（IndexedDB）中的数据格式与当前实现兼容
- 用户界面移除按钮不会影响其他功能的正常运行
- 收藏功能的本地存储机制已实现，只需优化交互逻辑

## Non-Functional Requirements

- **性能要求**：分类筛选响应时间≤200毫秒，统计数据更新响应时间≤1秒
- **可用性要求**：界面简化后，用户操作步骤减少，操作成功率≥95%
- **一致性要求**：所有页面显示的分类信息必须完全一致，不允许出现数据不一致的情况
